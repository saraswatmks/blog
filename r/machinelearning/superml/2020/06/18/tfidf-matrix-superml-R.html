<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>How to create TF-IDF matrix using ngrams in R? | Manish Saraswat</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="How to create TF-IDF matrix using ngrams in R?" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Create tfidf matrix in R just like using scikit-learn" />
<meta property="og:description" content="Create tfidf matrix in R just like using scikit-learn" />
<link rel="canonical" href="https://saraswatmks.github.io/blog/r/machinelearning/superml/2020/06/18/tfidf-matrix-superml-R.html" />
<meta property="og:url" content="https://saraswatmks.github.io/blog/r/machinelearning/superml/2020/06/18/tfidf-matrix-superml-R.html" />
<meta property="og:site_name" content="Manish Saraswat" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-18T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Create tfidf matrix in R just like using scikit-learn","@type":"BlogPosting","headline":"How to create TF-IDF matrix using ngrams in R?","dateModified":"2020-06-18T00:00:00-05:00","datePublished":"2020-06-18T00:00:00-05:00","url":"https://saraswatmks.github.io/blog/r/machinelearning/superml/2020/06/18/tfidf-matrix-superml-R.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://saraswatmks.github.io/blog/r/machinelearning/superml/2020/06/18/tfidf-matrix-superml-R.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://saraswatmks.github.io/blog/feed.xml" title="Manish Saraswat" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>How to create TF-IDF matrix using ngrams in R? | Manish Saraswat</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="How to create TF-IDF matrix using ngrams in R?" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Create tfidf matrix in R just like using scikit-learn" />
<meta property="og:description" content="Create tfidf matrix in R just like using scikit-learn" />
<link rel="canonical" href="https://saraswatmks.github.io/blog/r/machinelearning/superml/2020/06/18/tfidf-matrix-superml-R.html" />
<meta property="og:url" content="https://saraswatmks.github.io/blog/r/machinelearning/superml/2020/06/18/tfidf-matrix-superml-R.html" />
<meta property="og:site_name" content="Manish Saraswat" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-18T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Create tfidf matrix in R just like using scikit-learn","@type":"BlogPosting","headline":"How to create TF-IDF matrix using ngrams in R?","dateModified":"2020-06-18T00:00:00-05:00","datePublished":"2020-06-18T00:00:00-05:00","url":"https://saraswatmks.github.io/blog/r/machinelearning/superml/2020/06/18/tfidf-matrix-superml-R.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://saraswatmks.github.io/blog/r/machinelearning/superml/2020/06/18/tfidf-matrix-superml-R.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://saraswatmks.github.io/blog/feed.xml" title="Manish Saraswat" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Manish Saraswat</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">How to create TF-IDF matrix using ngrams in R?</h1><p class="page-description">Create tfidf matrix in R just like using scikit-learn</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-06-18T00:00:00-05:00" itemprop="datePublished">
        Jun 18, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#r">r</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#machinelearning">machinelearning</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#superml">superml</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#introduction">Introduction</a></li>
<li class="toc-entry toc-h2"><a href="#tf-idf-matrix-with-superml">TF-IDF Matrix with superml</a></li>
<li class="toc-entry toc-h2"><a href="#summary">Summary</a></li>
</ul><h2 id="introduction">
<a class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>Term Document/Inverse Document Frequency(TF-IDF) is a powerful text analysis technique to find similar documents based their vector representations. In simple words, it weights each token, not only on how many times it has occured in a particular document, but also across all set of documents (also called as corpus), to ensure that we put a lower weight to a token if it occurs too frequently (like stopwords).</p>

<p>Let’s see how we can create tf-idf matrix using ngrams. Later, we’ll train a simple random forest model on features generated from tf-idf.</p>

<p>You can install the package by doing:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"superml"</span><span class="p">,</span><span class="w"> </span><span class="n">dependencies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="tf-idf-matrix-with-superml">
<a class="anchor" href="#tf-idf-matrix-with-superml" aria-hidden="true"><span class="octicon octicon-link"></span></a>TF-IDF Matrix with superml</h2>

<p>Superml following a scikit-learn style api, so if you are familiar with it, superml should be easy for you. In case you are new to it, just follow the explanation below. Superml is based on C++ optimised functions, hence it should be quite fast as well.</p>

<p>First, we’ll try to get a dummy dataset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># download data, takes a few seconds</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readLines</span><span class="p">(</span><span class="s2">"https://www.r-bloggers.com/wp-content/uploads/2016/01/vent.txt"</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s1">'text'</span><span class="w">

</span><span class="c1"># also let's add a target variable, so later we can train a model on tfidf features</span><span class="w">
</span><span class="n">df</span><span class="o">$</span><span class="n">target</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now, we create tfidf features.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">superml</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Loading required package: R6
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">TfIdfVectorizer</span><span class="o">$</span><span class="n">new</span><span class="p">(</span><span class="n">ngram_range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">max_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.7</span><span class="p">)</span><span class="w">
</span><span class="n">tf_feats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tf</span><span class="o">$</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">text</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>Explanation</strong></p>

<ul>
  <li>
<code class="highlighter-rouge">ngram_range</code> as <code class="highlighter-rouge">c(1,3)</code> means 1 is the minimum length of ngram and 3 is the maximum length of ngram.</li>
  <li>
<code class="highlighter-rouge">max_df = 0.7</code> means ignore token (or word) should appear in more than 40% of the documents.</li>
  <li>
<code class="highlighter-rouge">$new()</code> method initialises the instance of <code class="highlighter-rouge">TfIdfVectorizer</code> class.</li>
  <li>
<code class="highlighter-rouge">$fit_transform()</code> return a matrix of tfidf features.</li>
</ul>

<p>Let’s see how the matrix looks like:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">dim</span><span class="p">(</span><span class="n">tf_feats</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1]   83 2059
</code></pre></div></div>

<p>We get 2059 features for the given data. Let’s look at the tokens.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colnames</span><span class="p">(</span><span class="n">tf_feats</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">30</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##  [1] "s"             "t"             "charleston"    "west"         
##  [5] "don"           "people"        "don t"         "see"          
##  [9] "virginia"      "west virginia" "just"          "news"         
## [13] "please"        " liar"         " s"            "liar"         
## [17] "obama"         "republicans"   "want"          "can"          
## [21] "good"          "hillary"       "problem"       "re"           
## [25] "show"          "trump"         "us"            " liar "       
## [29] "breaking"      "breaking news"
</code></pre></div></div>

<p>We see some text processing would be great before passing calculating the tfidf features. Let’s tke a look at the matrix.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">tf_feats</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="m">50</span><span class="o">:</span><span class="m">60</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##       problem   anyone ben ben carson c carson clear     deal drive every
## [1,]        0 0.000000   0          0 0      0     0 0.000000     0     0
## [2,]        0 0.166419   0          0 0      0     0 0.166419     0     0
## [3,]        0 0.000000   0          0 0      0     0 0.000000     0     0
##          iran
## [1,] 0.000000
## [2,] 0.166419
## [3,] 0.000000
</code></pre></div></div>

<p>Now, let’s train a random forest model on these features. But, before that let’s split the data into train and test.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n_rows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">%/%</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="n">train</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">tf_feats</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">n_rows</span><span class="p">,])</span><span class="w">
</span><span class="n">train</span><span class="o">$</span><span class="n">target_var</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="n">n_rows</span><span class="p">,]</span><span class="o">$</span><span class="n">target</span><span class="w">

</span><span class="n">test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">tf_feats</span><span class="p">[</span><span class="n">n_rows</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">),])</span><span class="w">
</span><span class="n">test</span><span class="o">$</span><span class="n">target_var</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">n_rows</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="s1">'target'</span><span class="p">]</span><span class="w">

</span><span class="nf">dim</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1]   41 2060
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">dim</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1]   43 2060
</code></pre></div></div>

<p>Ideally, we should have dont stratified sampling because the target variable is binary. Here, the idea is to demonstrate the use of superml for building machine learning models on text data.</p>

<p>Let’s train a random forest model. All machine learning models in superml are known as <code class="highlighter-rouge">Trainer</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">RFTrainer</span><span class="o">$</span><span class="n">new</span><span class="p">(</span><span class="n">max_features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">n_estimators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">rf</span><span class="o">$</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="w"> </span><span class="s1">'target_var'</span><span class="p">)</span><span class="w">

</span><span class="n">preds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rf</span><span class="o">$</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##  [1] 0 0 0 0 0 0 0 0 0 0
## Levels: 0 1
</code></pre></div></div>

<h2 id="summary">
<a class="anchor" href="#summary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Summary</h2>

<p>In this tutorial, we learned to train a random forest model using tfidf ngram features in R. Next, we’ll see how to create a simple ngram bag of words features model in R.</p>


  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="saraswatmks/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/r/machinelearning/superml/2020/06/18/tfidf-matrix-superml-R.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Using data science to solve real world problems</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/saraswatmks" title="saraswatmks"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/manish_saraswt" title="manish_saraswt"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
